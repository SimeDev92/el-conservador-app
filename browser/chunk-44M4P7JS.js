import{a as k}from"./chunk-Z7DADE6C.js";import{a as f,b as d}from"./chunk-WRRNA3JR.js";import{Ac as g,F as i,aa as m,ga as b,ib as l,q as h,r as p,u as n}from"./chunk-BUN7TGPH.js";var U=class a{baseUrl=k.baseUrl;http=b(d);_currentUser=l(null);_authStatus=l("cheking");currentUser=g(()=>this._currentUser());authStatus=g(()=>this._authStatus());constructor(){this.checkAuthStatus().subscribe()}setAuthentication(e,t){return this._currentUser.set(e),this._authStatus.set("authenticated"),localStorage.setItem("token",t),!0}login(e,t){let s=`${this.baseUrl}/auth/login`,o={email:e,password:t};return this.http.post(s,o).pipe(n(({user:r,token:u})=>this.setAuthentication(r,u)),i(r=>p(()=>r.error.message)))}register(e,t,s,o){let r=`${this.baseUrl}/auth/register`,u={email:e,password:t,name:s,surname:o};return this.http.post(r,u).pipe(n(c=>{let{user:v,token:S}=c;return this._currentUser.set(v),this._authStatus.set("registered"),localStorage.setItem("token",S),!0}),i(c=>p(()=>c.error.message)))}checkAuthStatus(){let e=`${this.baseUrl}/auth/check-token`,t=localStorage.getItem("token");if(!t)return this.logout(),h(!1);let s=new f().set("Authorization",`Bearer ${t}`);return this.http.get(e,{headers:s}).pipe(n(({user:o,token:r})=>this.setAuthentication(o,r)),i(()=>(this._authStatus.set("notAuthenticated"),h(!1))))}logout(){localStorage.removeItem("token"),this._currentUser.set(null),this._authStatus.set("notAuthenticated")}static \u0275fac=function(t){return new(t||a)};static \u0275prov=m({token:a,factory:a.\u0275fac,providedIn:"root"})};export{U as a};
